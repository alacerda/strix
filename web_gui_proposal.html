<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strix - Web GUI Proposal</title>
    <style>
        /* Reset e Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #22c55e;
            --primary-green-dark: #16a34a;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #475569;
            --success: #22c55e;
            --warning: #fbbf24;
            --error: #dc2626;
            --info: #0284c7;
            --critical: #dc2626;
            --high: #ea580c;
            --medium: #d97706;
            --low: #65a30d;
            --terminal: #22c55e;
            --browser: #06b6d4;
            --python: #3b82f6;
            --file-edit: #10b981;
            --proxy: #06b6d4;
            --agents-graph: #fbbf24;
            --thinking: #a855f7;
            --web-search: #22c55e;
            --finish: #dc2626;
            --reporting: #ea580c;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
        }

        /* Layout Principal */
        .app-container {
            display: flex;
            height: 100vh;
            gap: 1px;
            background: var(--border-color);
        }

        /* Sidebar Esquerda - Agentes */
        .sidebar-left {
            width: 300px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .sidebar-header {
            padding: 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h2 {
            font-size: 1.25rem;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agents-tree {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .agent-node {
            padding: 0.5rem;
            margin: 0.25rem 0;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            user-select: none;
        }

        .agent-node:hover {
            background: var(--bg-tertiary);
        }

        .agent-node.selected {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--primary-green);
        }

        .agent-node-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .agent-status-icon {
            font-size: 0.75rem;
        }

        .agent-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .agent-children {
            margin-left: 1.5rem;
            margin-top: 0.25rem;
            border-left: 1px solid var(--border-color);
            padding-left: 0.5rem;
        }

        /* Painel Central */
        .main-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
        }

        .main-header {
            padding: 1rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .main-header h1 {
            font-size: 1.5rem;
            color: var(--primary-green);
        }

        .agent-status-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dots {
            display: inline-block;
        }

        .status-dots::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            max-width: 80%;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            background: var(--bg-tertiary);
            border: 1px solid var(--primary-green);
        }

        .message.assistant {
            align-self: flex-start;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        .message-header {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .tool-execution {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border-left: 4px solid;
            background: var(--bg-secondary);
            margin: 0.5rem 0;
            animation: slideIn 0.3s ease-out;
        }

        .tool-execution.terminal { border-left-color: var(--terminal); }
        .tool-execution.browser { border-left-color: var(--browser); }
        .tool-execution.python { border-left-color: var(--python); }
        .tool-execution.file-edit { border-left-color: var(--file-edit); }
        .tool-execution.proxy { border-left-color: var(--proxy); }
        .tool-execution.agents-graph { border-left-color: var(--agents-graph); }
        .tool-execution.thinking { border-left-color: var(--thinking); }
        .tool-execution.web-search { border-left-color: var(--web-search); }
        .tool-execution.finish { border-left-color: var(--finish); }
        .tool-execution.reporting { border-left-color: var(--reporting); }

        .tool-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .tool-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: var(--bg-tertiary);
        }

        .tool-status.running { color: var(--warning); }
        .tool-status.completed { color: var(--success); }
        .tool-status.failed { color: var(--error); }

        .tool-args {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-family: 'Courier New', monospace;
        }

        .tool-result {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .chat-input-container {
            padding: 1rem;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .send-button {
            padding: 0.75rem 1.5rem;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .send-button:hover {
            background: var(--primary-green-dark);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stop-button {
            padding: 0.5rem 1rem;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .stop-button:hover {
            background: #b91c1c;
        }

        /* Sidebar Direita */
        .sidebar-right {
            width: 350px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
        }

        .stats-section {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-section h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--primary-green);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .severity-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.25rem;
        }

        .severity-critical { background: var(--critical); color: white; }
        .severity-high { background: var(--high); color: white; }
        .severity-medium { background: var(--medium); color: white; }
        .severity-low { background: var(--low); color: white; }
        .severity-info { background: var(--info); color: white; }

        .vulnerabilities-list {
            padding: 1rem;
        }

        .vulnerability-card {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-left: 4px solid;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .vulnerability-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .vulnerability-card.critical { border-left-color: var(--critical); }
        .vulnerability-card.high { border-left-color: var(--high); }
        .vulnerability-card.medium { border-left-color: var(--medium); }
        .vulnerability-card.low { border-left-color: var(--low); }
        .vulnerability-card.info { border-left-color: var(--info); }

        .vulnerability-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .vulnerability-title {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
        }

        .vulnerability-id {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'Courier New', monospace;
        }

        .vulnerability-content {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            line-height: 1.5;
        }

        .vulnerability-timestamp {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-color);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar-right {
                width: 300px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar-left, .sidebar-right {
                width: 100%;
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Esquerda - Agentes -->
        <div class="sidebar-left">
            <div class="sidebar-header">
                <h2>ü§ñ Agentes Ativos</h2>
            </div>
            <div class="agents-tree" id="agentsTree"></div>
        </div>

        <!-- Painel Central -->
        <div class="main-panel">
            <div class="main-header">
                <h1>ü¶â Strix Cybersecurity Agent</h1>
                <div class="agent-status-bar" id="agentStatusBar">
                    <div class="status-indicator">
                        <span id="statusText">Selecione um agente</span>
                        <span class="status-dots" id="statusDots" style="display: none;"></span>
                    </div>
                    <button class="stop-button" id="stopButton" style="display: none;">Parar Agente</button>
                </div>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="empty-state">
                        <div class="empty-state-icon">ü¶â</div>
                        <p>Selecione um agente da √°rvore para ver suas atividades</p>
                    </div>
                </div>
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input 
                            type="text" 
                            class="chat-input" 
                            id="chatInput" 
                            placeholder="Digite uma mensagem para o agente..."
                            disabled
                        />
                        <button class="send-button" id="sendButton" disabled>Enviar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Direita -->
        <div class="sidebar-right">
            <div class="stats-section">
                <h3>üìä Estat√≠sticas</h3>
                <div class="stat-item">
                    <span class="stat-label">Vulnerabilidades:</span>
                    <span class="stat-value" id="vulnTotal">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Agentes:</span>
                    <span class="stat-value" id="agentCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Ferramentas:</span>
                    <span class="stat-value" id="toolCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tokens (Input):</span>
                    <span class="stat-value" id="inputTokens">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tokens (Output):</span>
                    <span class="stat-value" id="outputTokens">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tokens (Cached):</span>
                    <span class="stat-value" id="cachedTokens">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Custo Total:</span>
                    <span class="stat-value" id="totalCost">$0.0000</span>
                </div>
            </div>

            <div class="stats-section">
                <h3>üîç Vulnerabilidades por Severidade</h3>
                <div id="severityBreakdown"></div>
            </div>

            <div class="vulnerabilities-list">
                <h3 style="padding: 1rem; padding-bottom: 0.5rem; font-size: 1rem; color: var(--primary-green);">üêû Vulnerabilidades Encontradas</h3>
                <div id="vulnerabilitiesList"></div>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplica√ß√£o
        const appState = {
            agents: {},
            selectedAgentId: null,
            messages: {},
            toolExecutions: {},
            vulnerabilities: [],
            stats: {
                agents: 0,
                tools: 0,
                inputTokens: 0,
                outputTokens: 0,
                cachedTokens: 0,
                cost: 0
            }
        };

        // Dados de exemplo simulados
        const sampleData = {
            agents: {
                'agent_root_001': {
                    id: 'agent_root_001',
                    name: 'Root Agent - Penetration Test',
                    status: 'running',
                    parentId: null,
                    task: 'Perform comprehensive security assessment of target application'
                },
                'agent_browser_002': {
                    id: 'agent_browser_002',
                    name: 'Browser Testing Agent',
                    status: 'running',
                    parentId: 'agent_root_001',
                    task: 'Test web application for XSS and CSRF vulnerabilities'
                },
                'agent_api_003': {
                    id: 'agent_api_003',
                    name: 'API Security Agent',
                    status: 'completed',
                    parentId: 'agent_root_001',
                    task: 'Analyze API endpoints for authentication and authorization flaws'
                },
                'agent_sql_004': {
                    id: 'agent_sql_004',
                    name: 'SQL Injection Agent',
                    status: 'waiting',
                    parentId: 'agent_root_001',
                    task: 'Test database interactions for SQL injection vulnerabilities'
                }
            },
            messages: {
                'agent_root_001': [
                    { role: 'user', content: 'Perform comprehensive security assessment of https://example.com', timestamp: new Date(Date.now() - 3600000) },
                    { role: 'assistant', content: 'I will start by analyzing the target application structure and identifying potential attack vectors.', timestamp: new Date(Date.now() - 3500000) },
                    { role: 'assistant', content: 'Creating specialized agents for different testing areas...', timestamp: new Date(Date.now() - 3400000) }
                ],
                'agent_browser_002': [
                    { role: 'assistant', content: 'Starting browser-based testing for XSS vulnerabilities...', timestamp: new Date(Date.now() - 3000000) },
                    { role: 'assistant', content: 'Found potential XSS vulnerability in search parameter.', timestamp: new Date(Date.now() - 2800000) }
                ],
                'agent_api_003': [
                    { role: 'assistant', content: 'Analyzing API endpoints...', timestamp: new Date(Date.now() - 3200000) },
                    { role: 'assistant', content: 'Testing authentication mechanisms...', timestamp: new Date(Date.now() - 3100000) },
                    { role: 'assistant', content: 'Completed API security analysis. Found 2 high-severity issues.', timestamp: new Date(Date.now() - 2900000) }
                ],
                'agent_sql_004': [
                    { role: 'assistant', content: 'Waiting for database connection details...', timestamp: new Date(Date.now() - 2700000) }
                ]
            },
            toolExecutions: {
                'agent_root_001': [
                    {
                        toolName: 'scan_start_info',
                        status: 'completed',
                        args: { target: 'https://example.com' },
                        result: { scan_id: 'scan_001' },
                        timestamp: new Date(Date.now() - 3600000)
                    },
                    {
                        toolName: 'agents_graph_action',
                        status: 'completed',
                        args: { action: 'create_agent', agent_type: 'browser_testing' },
                        result: { agent_id: 'agent_browser_002' },
                        timestamp: new Date(Date.now() - 3400000)
                    }
                ],
                'agent_browser_002': [
                    {
                        toolName: 'browser_action',
                        status: 'completed',
                        args: { action: 'navigate', url: 'https://example.com/search?q=<script>alert(1)</script>' },
                        result: { xss_detected: true, location: 'search parameter' },
                        timestamp: new Date(Date.now() - 2800000)
                    },
                    {
                        toolName: 'reporting_action',
                        status: 'completed',
                        args: { severity: 'high', title: 'XSS Vulnerability in Search Parameter' },
                        result: { report_id: 'vuln-0001' },
                        timestamp: new Date(Date.now() - 2750000)
                    }
                ],
                'agent_api_003': [
                    {
                        toolName: 'terminal_execute',
                        status: 'completed',
                        args: { command: 'curl -X GET https://example.com/api/users' },
                        result: { status_code: 200, response: '{"users": [...]}' },
                        timestamp: new Date(Date.now() - 3200000)
                    },
                    {
                        toolName: 'python_action',
                        status: 'completed',
                        args: { script: 'test_jwt_validation.py' },
                        result: { jwt_vulnerable: true, issue: 'No expiration check' },
                        timestamp: new Date(Date.now() - 3100000)
                    },
                    {
                        toolName: 'reporting_action',
                        status: 'completed',
                        args: { severity: 'high', title: 'JWT Token Validation Bypass' },
                        result: { report_id: 'vuln-0002' },
                        timestamp: new Date(Date.now() - 2900000)
                    }
                ]
            },
            vulnerabilities: [
                {
                    id: 'vuln-0001',
                    title: 'Cross-Site Scripting (XSS) in Search Parameter',
                    content: 'The application does not properly sanitize user input in the search parameter, allowing malicious scripts to be executed in the browser context. An attacker could inject JavaScript code that would execute when other users view the search results.',
                    severity: 'high',
                    timestamp: new Date(Date.now() - 2750000)
                },
                {
                    id: 'vuln-0002',
                    title: 'JWT Token Validation Bypass',
                    content: 'The API endpoint /api/users does not properly validate JWT token expiration. Tokens that should be expired are still accepted, allowing unauthorized access to user data.',
                    severity: 'high',
                    timestamp: new Date(Date.now() - 2900000)
                },
                {
                    id: 'vuln-0003',
                    title: 'Information Disclosure in Error Messages',
                    content: 'Error messages reveal sensitive information including database structure and file paths. This information could be used by attackers to plan more sophisticated attacks.',
                    severity: 'medium',
                    timestamp: new Date(Date.now() - 2000000)
                }
            ],
            stats: {
                agents: 4,
                tools: 8,
                inputTokens: 45230,
                outputTokens: 12340,
                cachedTokens: 8900,
                cost: 0.1245
            }
        };

        // Inicializar dados
        function initializeData() {
            appState.agents = sampleData.agents;
            appState.messages = sampleData.messages;
            appState.toolExecutions = sampleData.toolExecutions;
            appState.vulnerabilities = sampleData.vulnerabilities;
            appState.stats = sampleData.stats;
        }

        // Renderizar √°rvore de agentes
        function renderAgentsTree() {
            const container = document.getElementById('agentsTree');
            container.innerHTML = '';

            const rootAgents = Object.values(appState.agents).filter(a => !a.parentId);
            
            rootAgents.forEach(agent => {
                const node = createAgentNode(agent);
                container.appendChild(node);
            });
        }

        function createAgentNode(agent) {
            const node = document.createElement('div');
            node.className = 'agent-node';
            node.dataset.agentId = agent.id;
            
            if (appState.selectedAgentId === agent.id) {
                node.classList.add('selected');
            }

            const statusIcon = getStatusIcon(agent.status);
            
            node.innerHTML = `
                <div class="agent-node-content">
                    <span class="agent-status-icon">${statusIcon}</span>
                    <span class="agent-name">${agent.name}</span>
                </div>
            `;

            node.addEventListener('click', (e) => {
                e.stopPropagation();
                selectAgent(agent.id);
            });

            // Adicionar filhos
            const children = Object.values(appState.agents).filter(a => a.parentId === agent.id);
            if (children.length > 0) {
                const childrenContainer = document.createElement('div');
                childrenContainer.className = 'agent-children';
                
                children.forEach(child => {
                    const childNode = createAgentNode(child);
                    childrenContainer.appendChild(childNode);
                });
                
                node.appendChild(childrenContainer);
            }

            return node;
        }

        function getStatusIcon(status) {
            const icons = {
                'running': 'üü¢',
                'waiting': '‚è∏Ô∏è',
                'completed': '‚úÖ',
                'failed': '‚ùå',
                'stopped': '‚èπÔ∏è',
                'stopping': '‚è∏Ô∏è',
                'llm_failed': 'üî¥'
            };
            return icons[status] || 'üîµ';
        }

        // Selecionar agente
        function selectAgent(agentId) {
            appState.selectedAgentId = agentId;
            renderAgentsTree();
            renderChatMessages();
            updateAgentStatusBar();
            
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            chatInput.disabled = false;
            sendButton.disabled = false;
        }

        // Renderizar mensagens do chat
        function renderChatMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';

            if (!appState.selectedAgentId) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ü¶â</div>
                        <p>Selecione um agente da √°rvore para ver suas atividades</p>
                    </div>
                `;
                return;
            }

            const agent = appState.agents[appState.selectedAgentId];
            if (!agent) return;

            const messages = appState.messages[appState.selectedAgentId] || [];
            const tools = appState.toolExecutions[appState.selectedAgentId] || [];

            // Combinar e ordenar por timestamp
            const allEvents = [
                ...messages.map(m => ({ type: 'message', data: m })),
                ...tools.map(t => ({ type: 'tool', data: t }))
            ].sort((a, b) => a.data.timestamp - b.data.timestamp);

            allEvents.forEach(event => {
                if (event.type === 'message') {
                    const messageEl = createMessageElement(event.data);
                    container.appendChild(messageEl);
                } else {
                    const toolEl = createToolElement(event.data);
                    container.appendChild(toolEl);
                }
            });

            container.scrollTop = container.scrollHeight;
        }

        function createMessageElement(message) {
            const div = document.createElement('div');
            div.className = `message ${message.role}`;
            
            const time = formatTime(message.timestamp);
            div.innerHTML = `
                <div class="message-header">${message.role === 'user' ? 'Voc√™' : 'Agente'} ‚Ä¢ ${time}</div>
                <div>${escapeHtml(message.content)}</div>
            `;
            
            return div;
        }

        function createToolElement(tool) {
            const div = document.createElement('div');
            div.className = `tool-execution ${getToolClass(tool.toolName)}`;
            
            const statusClass = tool.status === 'completed' ? 'completed' : 
                               tool.status === 'failed' ? 'failed' : 'running';
            
            const time = formatTime(tool.timestamp);
            
            div.innerHTML = `
                <div class="tool-header">
                    <span>‚Üí ${getToolDisplayName(tool.toolName)}</span>
                    <span class="tool-status ${statusClass}">${tool.status}</span>
                </div>
                ${tool.args && Object.keys(tool.args).length > 0 ? `
                    <div class="tool-args">Args: ${JSON.stringify(tool.args, null, 2)}</div>
                ` : ''}
                ${tool.result ? `
                    <div class="tool-result">Result: ${JSON.stringify(tool.result, null, 2)}</div>
                ` : ''}
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">${time}</div>
            `;
            
            return div;
        }

        function getToolClass(toolName) {
            const mapping = {
                'terminal_execute': 'terminal',
                'browser_action': 'browser',
                'python_action': 'python',
                'file_edit_action': 'file-edit',
                'proxy_action': 'proxy',
                'agents_graph_action': 'agents-graph',
                'thinking_action': 'thinking',
                'web_search_action': 'web-search',
                'finish_action': 'finish',
                'reporting_action': 'reporting',
                'scan_start_info': 'agents-graph',
                'subagent_start_info': 'agents-graph'
            };
            return mapping[toolName] || 'agents-graph';
        }

        function getToolDisplayName(toolName) {
            const names = {
                'terminal_execute': 'Terminal Execute',
                'browser_action': 'Browser Action',
                'python_action': 'Python Action',
                'file_edit_action': 'File Edit',
                'proxy_action': 'Proxy Action',
                'agents_graph_action': 'Agents Graph',
                'thinking_action': 'Thinking',
                'web_search_action': 'Web Search',
                'finish_action': 'Finish',
                'reporting_action': 'Reporting',
                'scan_start_info': 'Scan Started',
                'subagent_start_info': 'Sub-agent Created'
            };
            return names[toolName] || toolName;
        }

        // Atualizar barra de status do agente
        function updateAgentStatusBar() {
            const statusBar = document.getElementById('agentStatusBar');
            const statusText = document.getElementById('statusText');
            const statusDots = document.getElementById('statusDots');
            const stopButton = document.getElementById('stopButton');

            if (!appState.selectedAgentId) {
                statusText.textContent = 'Selecione um agente';
                statusDots.style.display = 'none';
                stopButton.style.display = 'none';
                return;
            }

            const agent = appState.agents[appState.selectedAgentId];
            if (!agent) return;

            const status = agent.status;
            let text = '';
            let showDots = false;
            let showStop = false;

            if (status === 'running') {
                text = 'Executando...';
                showDots = true;
                showStop = true;
            } else if (status === 'waiting') {
                text = 'Aguardando';
                showDots = true;
            } else if (status === 'completed') {
                text = 'Conclu√≠do';
            } else if (status === 'failed' || status === 'llm_failed') {
                text = 'Falhou';
            } else if (status === 'stopped') {
                text = 'Parado';
            } else {
                text = status;
            }

            statusText.textContent = text;
            statusDots.style.display = showDots ? 'inline-block' : 'none';
            stopButton.style.display = showStop ? 'block' : 'none';
        }

        // Renderizar estat√≠sticas
        function renderStats() {
            document.getElementById('agentCount').textContent = appState.stats.agents;
            document.getElementById('toolCount').textContent = appState.stats.tools;
            document.getElementById('inputTokens').textContent = formatNumber(appState.stats.inputTokens);
            document.getElementById('outputTokens').textContent = formatNumber(appState.stats.outputTokens);
            document.getElementById('cachedTokens').textContent = formatNumber(appState.stats.cachedTokens);
            document.getElementById('totalCost').textContent = `$${appState.stats.cost.toFixed(4)}`;
            document.getElementById('vulnTotal').textContent = appState.vulnerabilities.length;
        }

        // Renderizar breakdown de severidade
        function renderSeverityBreakdown() {
            const container = document.getElementById('severityBreakdown');
            const counts = {
                critical: 0,
                high: 0,
                medium: 0,
                low: 0,
                info: 0
            };

            appState.vulnerabilities.forEach(v => {
                const severity = v.severity.toLowerCase();
                if (counts.hasOwnProperty(severity)) {
                    counts[severity]++;
                }
            });

            container.innerHTML = '';
            Object.entries(counts).forEach(([severity, count]) => {
                if (count > 0) {
                    const badge = document.createElement('span');
                    badge.className = `severity-badge severity-${severity}`;
                    badge.textContent = `${severity.toUpperCase()}: ${count}`;
                    container.appendChild(badge);
                }
            });

            if (container.innerHTML === '') {
                container.innerHTML = '<div style="color: var(--text-muted); font-size: 0.85rem;">Nenhuma vulnerabilidade encontrada</div>';
            }
        }

        // Renderizar lista de vulnerabilidades
        function renderVulnerabilities() {
            const container = document.getElementById('vulnerabilitiesList');
            container.innerHTML = '';

            if (appState.vulnerabilities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <p>Nenhuma vulnerabilidade encontrada ainda</p>
                    </div>
                `;
                return;
            }

            appState.vulnerabilities.forEach(vuln => {
                const card = document.createElement('div');
                card.className = `vulnerability-card ${vuln.severity.toLowerCase()}`;
                
                card.innerHTML = `
                    <div class="vulnerability-header">
                        <div class="vulnerability-title">${escapeHtml(vuln.title)}</div>
                        <div class="vulnerability-id">${vuln.id}</div>
                    </div>
                    <div class="vulnerability-content">${escapeHtml(vuln.content.substring(0, 150))}${vuln.content.length > 150 ? '...' : ''}</div>
                    <div class="vulnerability-timestamp">${formatTime(vuln.timestamp)}</div>
                `;

                card.addEventListener('click', () => {
                    alert(`Vulnerabilidade: ${vuln.title}\n\n${vuln.content}`);
                });

                container.appendChild(card);
            });
        }

        // Enviar mensagem
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !appState.selectedAgentId) return;

            // Adicionar mensagem ao estado
            if (!appState.messages[appState.selectedAgentId]) {
                appState.messages[appState.selectedAgentId] = [];
            }

            appState.messages[appState.selectedAgentId].push({
                role: 'user',
                content: message,
                timestamp: new Date()
            });

            input.value = '';
            renderChatMessages();

            // Simular resposta do agente ap√≥s 1 segundo
            setTimeout(() => {
                if (!appState.messages[appState.selectedAgentId]) {
                    appState.messages[appState.selectedAgentId] = [];
                }
                appState.messages[appState.selectedAgentId].push({
                    role: 'assistant',
                    content: 'Mensagem recebida. Processando...',
                    timestamp: new Date()
                });
                renderChatMessages();
            }, 1000);
        }

        // Parar agente
        function stopAgent() {
            if (!appState.selectedAgentId) return;
            
            const agent = appState.agents[appState.selectedAgentId];
            if (agent && agent.status === 'running') {
                if (confirm(`Tem certeza que deseja parar o agente "${agent.name}"?`)) {
                    agent.status = 'stopped';
                    renderAgentsTree();
                    updateAgentStatusBar();
                }
            }
        }

        // Utilit√°rios
        function formatTime(date) {
            if (!(date instanceof Date)) {
                date = new Date(date);
            }
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Simular atualiza√ß√µes em tempo real
        function simulateRealTimeUpdates() {
            setInterval(() => {
                // Simular novas execu√ß√µes de ferramentas ocasionalmente
                if (Math.random() > 0.7 && appState.selectedAgentId) {
                    const agent = appState.agents[appState.selectedAgentId];
                    if (agent && agent.status === 'running') {
                        const tools = ['terminal_execute', 'browser_action', 'python_action', 'thinking_action'];
                        const randomTool = tools[Math.floor(Math.random() * tools.length)];
                        
                        if (!appState.toolExecutions[appState.selectedAgentId]) {
                            appState.toolExecutions[appState.selectedAgentId] = [];
                        }
                        
                        appState.toolExecutions[appState.selectedAgentId].push({
                            toolName: randomTool,
                            status: 'completed',
                            args: { example: 'data' },
                            result: { success: true },
                            timestamp: new Date()
                        });
                        
                        appState.stats.tools++;
                        renderChatMessages();
                        renderStats();
                    }
                }
            }, 5000);
        }

        // Event listeners
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        document.getElementById('stopButton').addEventListener('click', stopAgent);

        // Inicializa√ß√£o
        function init() {
            initializeData();
            renderAgentsTree();
            renderStats();
            renderSeverityBreakdown();
            renderVulnerabilities();
            simulateRealTimeUpdates();
        }

        // Iniciar quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>

